<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN"
   "http://www.w3.org/TR/html4/strict.dtd">
<!-- AUTOGENERATED FILE: ALL EDITS WILL BE LOST!!! -->
<html lang="en">
<head>


<meta name="tags" contents="pimoroni,learn" />
<meta name="date" contents="2013-05-13 10:58" />
<meta name="category" contents="pimo" />
<meta name="author" contents="Hamish Cunningham" />
<meta name="summary" contents="Sensing and Responding" />


<title>Sensing and Responding</title>
<style type="text/css">
/*<![CDATA[*/
<!--
html, body {
  background: #fff;
  color: #000;
  font-family: sans-serif;
}
h1,h2,h3,h4,h5,p,ul,ol { font-family: sans-serif; }
pre { font-family: monospace; }
h3.navhead {
  font-size: 100%;
}
div.banner {
  border: none;
  margin-right: 0px;
  margin-left: 0px;
  padding: 0.09em;
  text-align: center;
  font-weight: bold; 
}
div.banner a:link, div.banner {
  background: #A0D0F0;
  color: #000000;
}
div.banner a:active {
  background: #000000;
  color: #FFFFFF;
}
div.banner a:hover {
  background: #000000;
  color: #FFFFFF;
-->
/*]]>*/
</style>
</head>
<body bgcolor="#FFFFFF" text="#000000">
<h1 class="cow-title-heading">Sensing and Responding</h1>

<p><em><a class="cow-url" href="http://gate.ac.uk/hamish/">Hamish Cunningham</a>, April 2013</em></p>

<div class="cow-contents"><h2 class="cow-heading">Contents</h2>
<p><ul>
<li><a href="#section-1.">1. Interaction Electronics</a></li>
<li><a href="#section-2.">2. Lighting Lights, Listening to Switches</a></li>
<li>&nbsp;&nbsp;<a href="#section-2.1.">2.1. Pins on the GPIO Header</a></li>
<li>&nbsp;&nbsp;<a href="#section-2.2.">2.2. Talking to the GPIO from Software</a></li>
<li>&nbsp;&nbsp;<a href="#section-2.3.">2.3. Reading from Switches</a></li>
<li>&nbsp;&nbsp;<a href="#section-2.4.">2.4. Putting it Together: Sensor plus LED</a></li>
<li><a href="#section-3.">3. Parent Alarm</a></li>
<li><a href="#section-4.">4. A Flood in the Basement</a></li>
<li><a href="#section-5.">5. Books and Resources</a></li>
<li>&nbsp;&nbsp;<a href="#section-5.1.">5.1. Source Code</a></li>
<li>&nbsp;&nbsp;<a href="#section-5.2.">5.2. Books about the Pi</a></li>
<li>&nbsp;&nbsp;<a href="#section-5.3.">5.3. Electronics Books and Sites</a></li>
<li>&nbsp;&nbsp;<a href="#section-5.4.">5.4. Circuits: Calculators, Simulators, Diagrams</a></li>
<li>&nbsp;&nbsp;<a href="#section-5.5.">5.5. Components</a></li>
<li><a href="#section-6.">6. Warning!</a></li>
</ul></p></div>

<p><a name="interaction-electronics"></a>
<a class="cow-section-anchor" name="section-1."></a><h1 class="cow-title-heading"><span class="cow-sec-number">1. </span>Interaction Electronics</h1>

<p>The Pi is a <em>general purpose</em> computer. It runs <a class="cow-url" href="http://www.gnu.org/">GNU</a>
<a class="cow-url" href="http://www.linuxfoundation.org/">Linux</a><span class="cow-footnote" name="footnote1"><sup><a href="#footnote1">1</a></sup></span>, which
is an operating system used in satellites and phones, desktops and tablets,
supercomputers and set-top boxes. It has graphics capabilities good enough for
full HD video, plus computational power and memory sufficient to run a web
browser or an office productivity suite. It has a good selection of standard
interconnectivity options (including ethernet, HDMI, stereo analogue sound,
and USB). Packing all of this into a very cheap, low power and low footprint
(made in the UK!) device is truly game changing.</p>

<p>Another game changer with the Pi is its ability to connect directly to
electronic circuits that can take readings from the physical environment and
trigger actions in that environment (and/or over the network). When you couple
a general purpose computing device with the Pi's extremely accessible
interaction electronics all sorts of projects become so simple that everyone
from school kids (Raspberry Pirates!) to absent-minded academic types can
achieve them within a short space of time. This combination of general purpose
computer with accessible electronics is a radical development.</p>

<p>Below we'll give <b>an introduction to sensing and responding with the Pi</b>, and
detail some projects that can be completed in a few hours with a few pounds'
worth of materials.</p>

<p>The Pi's connections for getting data from sensors and for activating external
gizmos are called <em>general purpose input output</em> pins, or GPIO pins. The
simplest of these will either sense or output a small voltage (3.3 volts, not
enough to give you a shock!). We can connect simple electronic circuits to
these pins to get the Pi interacting with its environment.</p>

<p>The Pi's GPIO pins are accessible via various software packages, which frees
us from the tyranny of the keyboard/mouse/screen combination and allows us to
program software to read from sensors and respond to changing conditions.</p>

<p>Here are some example projects that will teach you how to couple the Pi's GPIO
pins with easy-to-build interaction electronics:</p>

<ul>
<li><a class="cow-url" href="#hello-world">controlling an LED</a> (hello world!) and reading from a switch</li>
<li><a class="cow-url" href="#parent-alarm">hide! my parents are coming!</a> (a simple alarm system)</li>
<li><a class="cow-url" href="#flood-alarm">a flood alarm</a> with text message notifications to your phone</li>
</ul>

<p>These projects use a prototyping tool called a breadboard to get started
quickly and easily. For introductions to this way of working, and to hacker
electronics in general, see the <a class="cow-url" href="#electronics">electronics section</a> of the
<a class="cow-url" href="#resources">resources chapter</a>.</p>

<p><b>Disclaimer</b>: it is possible fry your Pi and other nasties by doing this type
of thing &mdash; please see <a class="cow-url" href="#warning">this warning</a> for details.</p>
</p>

<p><a name="hello-world"></a>
<a class="cow-section-anchor" name="section-2."></a><h1 class="cow-title-heading"><span class="cow-sec-number">2. </span>Lighting Lights, Listening to Switches</h1>

<p>Pretty much the simplest thing we can do with the Pi's GPIO header is to light
up an LED<span class="cow-footnote" name="footnote2"><sup><a href="#footnote2">2</a></sup></span> &mdash; let's make this our <em>Hello
World!</em><span class="cow-footnote" name="footnote3"><sup><a href="#footnote3">3</a></sup></span>. (If you've not done
this type of thing before, please read <a class="cow-url" href="#warning">this warning</a> first.)</p>

<p>Materials used:</p>
<ul>
<li>a breadboard</li>
<li>resistors (270&Omega;, 1k&Omega;, 10k&Omega;)</li>
<li>green and red LEDs</li>
<li>link wire</li>
<li>a switch</li>
<li>jumper cables</li>
<li>a multimeter (optional)</li>
</ul>

<p>To create a <em>Hello World!</em> lighting circuit we only need two electronic
components, an LED to light up and a resistor to prevent more current flowing
through the LED than it can handle.<span class="cow-footnote" name="footnote4"><sup><a href="#footnote4">4</a></sup></span> Here's the circuit
diagram<span class="cow-footnote" name="footnote5"><sup><a href="#footnote5">5</a></sup></span>:</p>

<p><a class="cow-url" href="https://www.circuitlab.com/circuit/m4rfw9/just-an-led-raspberry-pi/"><img src="just-an-led-ras-pi.svg" alt="just an LED" width="500"></a></p>

<p>Here D1 is the LED we're lighting up and R1 is a resistor that prevents too
much current flowing in the circuit. V1 represents the 3.3 volt power supply
that the Pi makes available, with +ve on GPIO pin 1 and ground on pin 6.
<b>Note</b> that I'm using the physical header pin numbers here as these are the
easiest numbers to quickly match up to the Pi circuit board (just count left
to right and top to bottom). There are several other ways to refer to the
pins, however, and several <em>gotchas</em> along the way &mdash; for more detail see the
discussion on <a class="cow-url" href="#gpio-pins">GPIO pins</a> below).</p>

<p>If we transfer this design onto our breadboard, we end up with something
looking like this: <br> <img src="bbd-simple-led.jpg" alt="simple LED breadboard" width="500"></p>

<p>So far, so boring: this is pretty much the equivalent of connecting a torch
bulb to a battery and going &quot;ahhh&quot; at the pretty light. More interesting,
especially in the context of our earlier discussion on general purpose devices
and <a class="cow-url" href="#interaction-electronics">interaction electronics</a>, is to drive the LED
by software; to do this all we need to do physically is connect the circuit to
a different pin on the GPIO header, in this case pin 11. Now spot the
difference:</p>

<p><a class="cow-url" href="https://www.circuitlab.com/circuit/vxz53u/driving-an-led-via-software-raspberry-pi/"><img src="driving-an-led-via-software-ras-pi.svg" alt="driving an LED" width="500"></a></p>

<p>Note the shift from pin 1 to pin 11 on the GPIO header. That's all! Now we're
almost ready to start turning the LED on and off using software running on the
Pi, but first we need to take a detour into the murky world of GPIO pin
numbering. (If you're lucky enough to have your Mum nearby you may want to ask
her to hold your hand while reading the next section. If it ends in tears
don't say I didn't warn you.)</p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

<p><a name="gpio-pins"></a></p><a class="cow-section-anchor" name="section-2.1."></a><h2 class="cow-heading"><span class="cow-sec-number">2.1. </span>Pins on the GPIO Header</h2>

<p>I think if I went on a course in Egyptian hieroglyphics for a month and then
revised my <a class="cow-url" href="http://www.ioccc.org/">obfuscated C</a> notes for a while I could
probably come up with a numbering scheme for the GPIO pins which was perhaps
half as confusing as the existing one. Actually that's a little unfair, but
the problem is that there are four <em>separate</em> ways to refer to the pins, all
different, all useful. To begin with, there are two offical numbering schemes,
one relating to the physical header on the Pi circuit board that we actually
make connections to (numbered 1 to 26), and the other relating to where they
interface to the Broadcom <em>system on a chip</em> at the heart of the beast (the
<a class="cow-url" href="http://www.broadcom.com/products/BCM2835">BCM2835</a>). Then there's also a
name for the function of the pin (e.g. 'GPIO 0'), and an extra complication is
that a couple of pins changed function in the 'revision 2' version of the Pi.
Finally, the way that we access the pins through software also has its own
nomenclature, and, because some of that software generalises across multiple
devices (e.g. the Pi and the Arduino) again the numbering is completely
different.</p>

<p>I think I'd need to add runes and Clingon symbols to the mix if I was really
trying to challenge the supremacy of the confusion that can result here.</p>

<p>Luckily there are a number of good sources to turn to for help. My favourite
is from Gordon Henderson, creator of <a class="cow-url" href="http://wiringpi.com/">Wiring Pi</a>, an
excellent software library for talking to the Pi (and several other boards). I
recommend printing out <a class="cow-url" href="http://wiringpi.com/pins/">Gordon's key to the GPIO
pins</a> and keeping it handy at all times. I also <b>strongly recommend</b> working
on the Pi with the pins positionned in the top right corner, not the other way
around, so that the numbers on the diagram match up with the orientation of
the Pi. So <em>do not</em> do the following if you value your sanity (assuming you
still have some left, that is<span class="cow-footnote" name="footnote6"><sup><a href="#footnote6">6</a></sup></span>): <br> <img src="upside-down-gpio.jpg" alt="wrong!" width="500"></p>

<p>The Pi's GPIO facilities cover a lot of other useful functions that we've not
even hinted at so far. Consult one of <a class="cow-url" href="#pi-books">the Pi books</a> for details,
or see this <a class="cow-url" href="http://t.co/JIRxM6qBAm">nice summary one-pager</a> from
<a class="cow-url" href="http://pimoroni.com/">Pimoroni</a>, makers of the fabulously cute PiBow case &mdash;
<br> <img src="pibow.jpg" alt="PiBow" width="300"> <br> &mdash; and home of the
<a class="cow-url" href="http://www.raspberrypi.org/archives/221">Pi logo's creator</a>, Paul
Beech<span class="cow-footnote" name="footnote7"><sup><a href="#footnote7">7</a></sup></span>.</p>

<!--% pibow image url: http://cdn.shopify.com/s/files/1/0174/1800/products/pibow-classic_1024x1024.jpg?2712-->



<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-2.2."></a><h2 class="cow-heading"><span class="cow-sec-number">2.2. </span>Talking to the GPIO from Software</h2>

<p>Now we're ready to write some software to control the interaction electronics
that we're connecting to the Pi.</p>

<p>Although the Linux operating system running on your Pi provides access to the
GPIO pins at a low level via the <em>sysfs</em> virtual file system, it is generally
easier to use a higher level library that abstracts a little further away from
the underlying hardware. Such libraries exist for (at least) Perl, Unix shell
script, Python, Scratch and Java. We'll use the <a class="cow-url" href="http://wiringpi.com/">WiringPi</a> library from <a class="cow-url" href="https://projects.drogon.net/">Gordon Henderson</a>,
which makes available the same abstractions for various devices and is a well
tested and robust piece of kit. (Thanks Gordon!)</p>

<p>WiringPi provides a convenient command-line program called <tt>gpio</tt> that we can
use to control and read from the GPIO pins, and we'll use this in our
examples. This means that we're going to be programming in <em>Unix shell
script</em>, which is the command language that the Pi's
<a class="cow-url" href="http://www.raspbian.org/">Raspbian</a> Linux operating system drops you
into by default when you log in. This language can be used from the command
prompt (the <tt>$</tt> or <tt>#</tt> that appears on screen to prompt you to make an input)
and can also be collected into a file and used as a command (or script) in
itself. This makes it the most direct way to experiment with Pi programming
(not to mention controlling many types of computer), and is well worth
learning, even if you're also learning a higher level language like Scratch,
Java or Python.</p>

<p>GPIO pins either listen for a signal (in input mode) or produce a signal (in
output mode). Our first job when programming GPIO interaction code, then, is
to decide which mode the pins we're working with should be in, and ask
WiringPi to set them up accordingly. Refering back to our circuit diagram,
<br>
<a class="cow-url" href="https://www.circuitlab.com/circuit/vxz53u/driving-an-led-via-software-raspberry-pi/"><img src="driving-an-led-via-software-ras-pi.svg" alt="driving an LED" width="500"></a> <br>
we see that header pin 11 is what we're using to drive the LED &mdash; i.e. make an
<em>output</em> &mdash; and that therefore we need to set pin 11 into output mode. For
reasons <a class="cow-url" href="#gpio-pins">discussed above</a> header pin 11 is known to WiringPi as
GPIO 0, so we use the <tt>gpio</tt> utility to set the mode for that pin like this:</p>

<p><tt>gpio mode 0 out</tt></p>

<p>We can read this as &quot;call the gpio program to set the mode of pin 0 to
output&quot;. (We don't need to do anything with pin 6, as this is always connected
to ground and doesn't have a mode setting.) Next, let's turn our output pin on
and see our LED light up:</p>

<p><tt>gpio write 0 1</tt></p>

<p>Again we're operating on pin 0, this time setting it high (to 3.3 volts &mdash; see
next section). And now turn it off again (to 0 volts):</p>

<p><tt>gpio write 0 0</tt></p>

<p>Magic!</p>

<p>For our next trick, let's get our Pi to sense something in the outside world,
and respond to that input by again turning the LED on and off.</p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

<p><a name="switches"></a></p><a class="cow-section-anchor" name="section-2.3."></a><h2 class="cow-heading"><span class="cow-sec-number">2.3. </span>Reading from Switches</h2>

<p>Let's recap where we've got to. First we hooked up an LED and a resistor to
the Pi's 3.3v supply, then moved it onto one of the GPIO pins and discovered
how to switch it on and off via software. Now let's look at an example of the
other side of the interaction coin, reading from a sensor. To get us started
we'll use a switch as a sensor, and get our Pi software to respond to the
position of the switch.</p>

<p>There are several example circuits for this type of thing knocking around; our
starting point below is adapted from
<a class="cow-url" href="http://elinux.org/RPi_Tutorial_EGHS:Switch_Input">an Embedded Linux
tutorial</a>. Another good source (though using Python instead of shell script)
is this 
<a class="cow-url" href="http://www.cl.cam.ac.uk/projects/raspberrypi/tutorials/robot/buttons_and_switches/">physical computing tutorial</a> from the Cambridge University lab where the
<a class="cow-url" href="http://www.raspberrypi.org/about">Pi originated</a>.</p>

<p>To make things a little more interesting we'll combine the data we get from
the switch with the LED control circuit we developed above. In each case we're
using the Pi's native logic voltage of 3.3 volts to signify binary 1 and using
0 volts to signify binary 0. (We can think of these as &quot;on&quot; and &quot;off&quot;, or
&quot;high&quot; and &quot;low&quot;, or even &quot;true&quot; and &quot;false&quot;, depending on what sort of mood
we're in.) We'll read either a 0 or a 1 from our circuit depending on whether
the switch is either open or closed respectively.</p>

<p>First here's the circuit to read the position of a switch<span class="cow-footnote" name="footnote8"><sup><a href="#footnote8">8</a></sup></span>:
<br>
<a class="cow-url" href="https://www.circuitlab.com/circuit/2475qd/switch-with-pull-down-resistor-raspberry-pi/"><img src="switch-with-pull-down-resistor.svg" alt="reading from switch" width="450"></a> <br>
We connect the switch SW1 to the (always on) 3.3v supply (header pin 1), so
that when the switch is in the on position it will supply the logical high
value. Resistor R1 prevents mishaps if we accidentally set header pin 11 to
output at low (i.e. try to get the poor thing to pull the 3.3v supply to 0v,
with unhappy consequences). Then we use a <em>pull down resistor</em>, R2, to drag
pin 11 low when the switch is open. When the switch is closed, R2 being much
higher than R1 implies that pin 11 will be pulled high by the 3.3v supply from
pin 1.</p>

<p>Confused? There's more explanation in the Embedded Linux tutorial linked
above, and a much more detailed presentation 
<a class="cow-url" href="http://www.ladyada.net/learn/arduino/lesson5.html">at AdaFruit</a>. (The latter
is in relation to the Arduino but the principles are the same.)</p>

<p>The breadboard to implement this circuit looks like this: <br>
<img src="bbd-simple-switch.jpg" alt="simple switch breadboard" width="500"></p>

<p>All we need now is some code to test what position the switch is in. We're
sensing on header pin 11, which is WiringPi's 0, so we set 0 to input mode:</p>

<p><tt>gpio mode 0 in</tt></p>

<p>Now we can read the value like this:</p>

<p><tt>gpio read 0</tt></p>

<p>When the switch is on this will return a 1, and when it is off a 0. We're on a
roll!<span class="cow-footnote" name="footnote9"><sup><a href="#footnote9">9</a></sup></span></p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-2.4."></a><h2 class="cow-heading"><span class="cow-sec-number">2.4. </span>Putting it Together: Sensor plus LED</h2>

<p>We've nearly completed our lightening tour of the basics of interaction
electronics with the Pi's GPIO facility. To finish off we'll connect up the
sensing and responding sides of the picture. Here's a circuit which combines
sensing from a switch with turning an LED on and off via software. The result
is that we will now both sense from the switch and respond to the sensor data
from software.</p>

<p><a class="cow-url" href="https://www.circuitlab.com/circuit/886nta/sensing-from-switch-and-driving-led-raspberry-pi/"><img src="sensing-from-switch-and-driving-led.svg" alt="switch and LED" width="550"></a></p>

<p>Nothing new here &mdash; we've just combined with LED driver circuit that we began
with and the switch reader circuit that in the previous section. Here we have
the switch sensor to the left and the LED driver to the right.</p>

<p>The breadboard to implement this circuit looks like this: <br>
<img src="bbd-switch-plus-led.jpg" alt="switch plus LED breadboard" width="500"></p>

<p><img src="bbd-switch-plus-led-detail.jpg" alt="switch plus LED breadboard detail" width="500">
<br>
We've use a four-way switch (in &quot;dual in line&quot; or DIL pin style) because we
had one handy and because it was easy to connect to the breadboard, but we're
only using one of its channels &mdash; the equivalent of an SPST or &quot;single pole
single throw&quot; switch.</p>

<p>The code to drive this uses some neat features of Unix shell script:</p>

<pre>
gpio mode 0 in
gpio mode 1 out

while :
do
  gpio write 1 `gpio read 0`
  sleep 1
done
</pre>

<p>The <tt>while :</tt> loop repeats forever (in shell &quot;:&quot; is a no-op command which
always returns true, so the loop never hits a termination condition). We do
this so that the program keeps testing to see if the switch position has
changed. We don't really need to do this every few milliseconds, so to make
the resultant load on the machine a little lower we use <tt>sleep</tt> to pause the
program and set a wakeup timer in the operating system. The value of &quot;1&quot;
passed to <tt>sleep</tt> means &quot;one second&quot;, so our loop will run once per second, or
thereabouts.<span class="cow-footnote" name="footnote10"><sup><a href="#footnote10">10</a></sup></span></p>

<p>The forward quotes (or backticks) in <tt>gpio write 1 `gpio read 0`</tt> do &quot;command
substitution&quot;: they run the command contained between the two quotes and
replace the command with whatever is returned, then running the enclosing
command. Here we're saying &quot;read a value from GPIO 0&quot; and then &quot;write that
value to GPIO 1&quot;. When the switch is on GPIO 0 will read high (and the command
will return 1), at which point we'll write 1 to GPIO 1, our output pin which
is driving the LED (so the LED will turn on). If the switch is off, then GPIO
0 will read low, returning 0 which will then be written to the output pin and
turn the LED off.</p>

<p>So we've now written a program on the Pi that is both sensing from the outside
world (the position of the switch) and sending out a response (lighting or
extinguishing the LED). We've taken our first steps in interaction
electronics; now its time to look at a couple of simple projects that we can
build using the techniques that we've learned so far.</p>
</p>

<p><a name="parent-alarm"></a>
<a class="cow-section-anchor" name="section-3."></a><h1 class="cow-title-heading"><span class="cow-sec-number">3. </span>Parent Alarm</h1>

<p>Parents &mdash; they're quite handy for doing the shopping and making breakfast and
the like, but they do tend to get in the way, don't they? And even perfectly
innocent teenage activities like building a particle accelerator in your
bedroom can easily lead to awkward questions and family misunderstandings.</p>

<p>Let's use a Pi and a pressure mat to give an early warning of parental feet in
the corridor.</p>

<p>Materials:</p>
<ul>
<li>bell wire or similar</li>
<li>a pressure pad sensor</li>
<li>a breadboard</li>
<li>resistors (270&Omega;, 1k&Omega;, 10k&Omega;)</li>
<li>green and red LEDs</li>
<li>link wire</li>
<li>jumper cables</li>
<li>a multimeter (optional)</li>
</ul>

<p>The first part is easy: we just replace the switch in the <a class="cow-url" href="#switches">reading
from switches</a> circuit with a pressure mat<span class="cow-footnote" name="footnote11"><sup><a href="#footnote11">11</a></sup></span>. Here's an example
mat:</p>

<p><img src="pressure-mat.jpg" alt="a pressure mat" width="500"></p>

<p>This works just like a switch &mdash; there are two wires to connect to, and when a
heavy object (e.g. a parent) stands on the mat the two wires are connected
(i.e. the resistance between them cycles between very high and very
low).<span class="cow-footnote" name="footnote12"><sup><a href="#footnote12">12</a></sup></span>
So we can use exactly the same circuit we used earlier for reading from a
switch and turning an LED on or off:</p>

<p><a class="cow-url" href="https://www.circuitlab.com/circuit/886nta/sensing-from-switch-and-driving-led-raspberry-pi/"><img src="sensing-from-switch-and-driving-led.svg" alt="switch and LED" width="550"></a></p>

<p>One limitation of this circuit is that if Mum should happen to pop in one day
and zap 50,000 volts across the Pi's GPIO pins the poor thing is unlikely to
remain enthusiastic about driving our indicator LED &mdash; but we won't actually
know that anything has changed, because as it stands there is no indication of
normal operation as opposed to the various possible failure conditions. The
next circuit addresses this limitation by adding another LED that is lit up
when the pressure pad is <em>not</em> being stood on. That way we'll have an
indicator of what state the system is in for both the &quot;everything's ok&quot; and
the &quot;run and hide!&quot; conditions, so we'll immediately know if we've forgotten
to switch the thing on, or if one of the LEDs has died, or etc.</p>

<p>The circuit: <br>
<a class="cow-url" href="https://www.circuitlab.com/circuit/56x6hf/an-alarm-with-two-leds-raspberry-pi/"><img src="an-alarm-with-two-leds.svg" alt="alarm with two LEDs" width="500"></a></p>

<p>The breadboard for this circuit looks like this: <br></p>

<!--% NOTE: this is actually wired up with the LEDs on pins 11 and 13 and the-->

<!--% switch on 12, or similar; we just ignore this in the text, but really we-->

<!--% should redo the breadboard and the local-bin/water-alarm.sh code-->


<p><img src="bbd-with-mat.jpg" alt="breadboard with pressure mat" width="500"></p>

<p>The green LED runs when the mat is <em>not</em> being stood on, indicating that all
is fine; the yellow LED (red would also be a good colour) lights up when it's
time to hide the particle accelerator and pretend to be doing the homework.</p>

<p>A closer look:</p>

<p><img src="bbd-with-mat-detail.jpg" alt="breadboard with pressure mat detail" width="500"></p>

<p>We need a new program to drive the extra LED (which is on Wiring Pi's GPIO 2,
connected on physical header pin 13). In Unix shell script a suitable
program is this:</p>

<pre>
gpio mode 0 in
gpio mode 1 out
gpio mode 2 out

while :
do
  if [ `gpio read 0` == 1 ]
  then
    gpio write 1 1
    gpio write 2 0
  else
    gpio write 1 0
    gpio write 2 1
  fi
  sleep 1
done
</pre>

<p>Here the two LEDs are controlled on GPIO 1 and 2, and as before we're reading
the input on GPIO 0. When someone stands on the pressure mat the input is 1,
and the first branch of the <tt>if</tt> statement will turn the first LED on and the
second one off; otherwise the reverse will happen. So of our two LEDs, one
will indicate safety and the other an alarm state.</p>

<p>Job done.</p>
</p>

<p><a name="flood-alarm"></a>
<a class="cow-section-anchor" name="section-4."></a><h1 class="cow-title-heading"><span class="cow-sec-number">4. </span>A Flood in the Basement</h1>

<p>There's a poltergeist who lives in my basement. Either that, or I've had three
completely coincidental pipe failures in the space of a couple of years. The
last leak had such a high flow rate that if I hadn't wandered past in the
morning and wondered what that hissing noise was we would have had a brand new
swimming pool by the evening. The most worrying thing was that the leak came
from a pipe joint that was brand new a year ago (and not fitted by me, either,
but by a skilled professional<span class="cow-footnote" name="footnote13"><sup><a href="#footnote13">13</a></sup></span>).</p>

<p>So I decided I needed a bit of long-term plumbing reassurance in the form of a
water alarm that will send me an SMS text message whenever things get wetter
than expected under the house. With a Pi and an alarm circuit like
<a class="cow-url" href="#parent-alarm">our parent alarm</a> this turns out to be a nice project.</p>

<p>Materials used:</p>
<ul>
<li>as per the parent alarm, minus the pressure pad</li>
<li>a simple mobile phone with USB cable, or a network-connection and an account
  on an SMS web service</li>
</ul>

<p>The trick here is to find a way to sense the presence of moisture. As water
conducts electricity we can do this using a variation on one of our
<a class="cow-url" href="#switches">switching circuits</a>: we'll run a length of two-core wire through
all the areas where we expect flooding and strip each core so that a flood
would connect the two cores together.</p>

<p>To decide on the values for the circuit that we'll use to connect to the Pi,
we need to test the resistance of the water connections using a multimeter; it
turns out that we have something between 20k and 50k ohms when the bare wire
is immersed. When the wire is dry (hopefully the long-term average!) the
resistance will be infinite (like an open switch). We also should expect that
the wires may touch (if someone steps on them and presses them together, for
example), so we also have to cater for a 0 ohms resistance. To deal with these
possibilities we'll use a 1k limiting resistor and a 100k pull down resistor
like this:
<br> <a class="cow-url" href="https://www.circuitlab.com/circuit/at8v7f/water-sensor-raspberry-pi/"><img src="water-sensor-raspberry-pi.svg" alt="water sensor" width="500"></a> <br>
Here's what happens in our three cases:</p>
<ul>
<li>When the wire is dry, R1 acts as an infinite resistance, and pin 11 (which
  we set in input mode) is pulled low via R2 and R3.</li>
<li>When the wire is wet, R1's resistance will be some way lower than that of R3
  (the pull down resistor) and so pin 11 will be pulled high.</li>
<li>If the wires are shorted R1's resistance will be close to zero, but we will
  not draw too much current from the Pi because of the presence of R2.</li>
</ul>

<p>The code to read from our water sensor is very simple: <tt>gpio mode 0 in</tt> sets
things up, and <tt>gpio read 0</tt> takes a reading. When things get wet (or there's
a short circuit) the read statement will return 1; otherwise it will return 0.</p>

<p><a class="cow-url" href="https://www.circuitlab.com/circuit/p989jw/using-a-transistor-to-drive-a-buzzer-raspberry-pi/"><img src="using-a-transistor-to-drive-a-buzzer.svg" alt="transistor driving buzzer" width="500"></a></p>

<p>TODO</p>
<ul>
<li>explain buzzer</li>
<li>Fred's notification stuff, one using BulkSMS.co.uk and the other using the
  Nokia 6230i</li>
<li>Dom's Twitter notifications setup</li>
</ul>
</p>

<p><a name="resources"></a>
<a class="cow-section-anchor" name="section-5."></a><h1 class="cow-title-heading"><span class="cow-sec-number">5. </span>Books and Resources</h1>

<p>TODO</p>
<ul>
<li>add <a class="cow-url" href="http://electronicsclub.info/">http://electronicsclub.info/</a></li>
</ul>

<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

<p><a name="code"></a></p><a class="cow-section-anchor" name="section-5.1."></a><h2 class="cow-heading"><span class="cow-sec-number">5.1. </span>Source Code</h2>

<p>Source code for the projects is available on the <a class="cow-url" href="http://gitorious.org/">Gitorious</a> open source hosting site. The project is called
<a class="cow-url" href="https://gitorious.org/pifi/">PiFi</a>. To get started install git and clone
the master branch:</p>

<pre>
git clone git@gitorious.org:pifi/pifi.git
</pre>

<p>This will create a directory <tt>pifi</tt> on your local system. See the file
<tt>README.txt</tt> in that directory for details of what is where.</p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

<p><a name="pi-books"></a></p><a class="cow-section-anchor" name="section-5.2."></a><h2 class="cow-heading"><span class="cow-sec-number">5.2. </span>Books about the Pi</h2>

<p>TODO</p>

<ul>
<li>Upton's book</li>
<li>the Haynes manual</li>
<li>others?</li>
</ul>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

<p><a name="electronics-resources"></a></p><a class="cow-section-anchor" name="section-5.3."></a><h2 class="cow-heading"><span class="cow-sec-number">5.3. </span>Electronics Books and Sites</h2>

<p>For introductions to basic circuit building, breadboarding or soldering, and
to hacker electronics in general, see for example:</p>

<ul>
<li><a class="cow-url" href="http://www.simonmonk.org/">Simon Monk's</a> 2013 book
  <a class="cow-url" href="http://www.simonmonk.org/?page_id=74">Hacking Electronics</a>, which achieves
  a nice balance between explaining relevant theory and quickly getting on
  with practical stuff right from the start. Although some of the chapters are
  specific to the Arduino<span class="cow-footnote" name="footnote14"><sup><a href="#footnote14">14</a></sup></span> there's a lot of generally useful stuff too, including
  introductions to breadboarding, stripboard, soldering and the like. A good
  book if you're in a hurry.</li>
<li>The 2009
  <a class="cow-url" href="http://www.makershed.com/Make_Electronics_book_by_Charles_Platt_p/9780596153748.htm">Make Electronics</a> by Charles Platt, which also has loads of great
  introductory material, and is a typically high quality O'Reilly production
  with <a class="cow-url" href="http://makezine.com/">Make Magazine</a>'s usual emphasis on colourful
  graphics and detailed instructions for the hobbyist. This book is very
  detailed and has lots of intriguing background<span class="cow-footnote" name="footnote15"><sup><a href="#footnote15">15</a></sup></span>.</li>
<li>The <a class="cow-url" href="http://elinux.org/">Embedded Linux wiki</a> has great globs of Pi-related
  stuff, including a bunch of very useful <a class="cow-url" href="http://elinux.org/RPi_Tutorials">tutorials</a>.</li>
<li><a class="cow-url" href="http://adafruit.com/">AdaFruit</a>'s <a class="cow-url" href="http://learn.adafruit.com/">tutorial
  pages</a> include an excellent guide to
  <a class="cow-url" href="http://learn.adafruit.com/adafruit-guide-excellent-soldering">soldering</a>
  (and one for <a class="cow-url" href="http://learn.adafruit.com/multimeters">measuring</a>).</li>
</ul>

<p>And lots and lots of others!<span class="cow-footnote" name="footnote16"><sup><a href="#footnote16">16</a></sup></span></p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-5.4."></a><h2 class="cow-heading"><span class="cow-sec-number">5.4. </span>Circuits: Calculators, Simulators, Diagrams</h2>

<p>The circuit diagrams are available on
<a class="cow-url" href="https://www.circuitlab.com/browse/by-tag/hamish-cunningham/">Circuit Lab</a>
under Creative Commons
<a class="cow-url" href="http://creativecommons.org/licenses/by-nc-sa/3.0/">BY-NC-SA
licence</a>.</p>

<p>Voltage/Resistance/Current calculators</p>
<ul>
<li><a class="cow-url" href="http://www.the12volt.com/ohm/ohmslawcalculators.asp">http://www.the12volt.com/ohm/ohmslawcalculators.asp</a></li>
<li><a class="cow-url" href="http://www.rapidtables.com/calc/electric/ohms-law-calculator.htm">http://www.rapidtables.com/calc/electric/ohms-law-calculator.htm</a></li>
<li><a class="cow-url" href="http://www.sengpielaudio.com/calculator-ohm.htm">http://www.sengpielaudio.com/calculator-ohm.htm</a></li>
</ul>

<p>Pi hobby sites</p>
<ul>
<li><a class="cow-url" href="http://raspberrypi.goddess-gate.com/">http://raspberrypi.goddess-gate.com/</a></li>
</ul>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-5.5."></a><h2 class="cow-heading"><span class="cow-sec-number">5.5. </span>Components</h2>

<ul>
<li>BC549C NPN transistor
  <a class="cow-url" href="http://alltransistors.com/transistor.php?transistor=23414">http://alltransistors.com/transistor.php?transistor=23414</a></li>
</ul>
</p>

<p><a name="warning"></a>
<a class="cow-section-anchor" name="section-6."></a><h1 class="cow-title-heading"><span class="cow-sec-number">6. </span>Warning!</h1>

<p><a class="cow-url" href="http://img.medscape.com/slide/migrated/editorial/cmecircle/2008/9146/images/slide61.jpg"><img src="http://img.medscape.com/slide/migrated/editorial/cmecircle/2008/9146/images/slide61.jpg" alt="recipes for disaster" width="500"></a></p>
<!--% from http://www.medscape.org/viewarticle/573016-->


<p>Although all the voltages we're working with here are too small to hurt a big
lump of a thing like a human being, it <em>is</em> perfectly possible to destroy your
Pi by making connections to the wrong pins! It is also theoretically possible
to create enough heat to start a fire (probably only if you pile something
extremely flammable on top of it all and wait a week or so, but nevertheless
please be warned).</p>

<p>The Pi has very low power consumption, but if you're an electronics newcomer
(or even just dopey and error-prone like me) the safe thing to do is always
power down whenever you're not working on your rig. And to <b>proceed with
caution</b>!</p>

<p><b>Soldering</b> brings with it its own set of potential gotchas of course. There's
a clue to this in the involvement of a hot iron, molten metal and heated wires
&mdash; we leave it as an exercise for the reader as to what happens when you touch
something really hot with a part of your anatomy. If in doubt, don't try this
at home.</p>

<p>Finally, please note that it is quite possible that these paragraphs contain
nuts. Why don't sharks eat lawyers? Professional courtesy.</p>
</p>
<span class="cow-footnote-section">
<h1 class="cow-heading">Footnotes</h1>
<p><ol>
<li>
<a class="cow-footnote-anchor" name="footnote1"></a>
<span class="cow-footnote-text" name="footnote1">To be picky, the Pi's
default operating system's full title would be the <a class="cow-url" href="http://www.raspbian.org/">Raspbian</a> distribution of <a class="cow-url" href="http://www.debian.org/">Debian</a>
<a class="cow-url" href="http://www.gnu.org/">GNU</a> <a class="cow-url" href="http://www.linuxfoundation.org/">Linux</a>.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote2"></a>
<span class="cow-footnote-text" name="footnote2">LED: Light Emitting Diode.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote3"></a>
<span class="cow-footnote-text" name="footnote3">'Hello world!' is
<a class="cow-url" href="https://en.wikipedia.org/wiki/Hello_world_program">by convention</a> the first
program we write in a new language or for a new device.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote4"></a>
<span class="cow-footnote-text" name="footnote4">Gordon Henderson gives a good
presentation of how to do this in his
<a class="cow-url" href="https://projects.drogon.net/raspberry-pi/gpio-examples/tux-crossing/gpio-examples-1-a-single-led/">GPIO examples pages</a>.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote5"></a>
<span class="cow-footnote-text" name="footnote5"><a class="cow-url" href="https://www.circuitlab.com/browse/by-tag/hamish-cunningham/">Circuit diagrams</a> were drawn and debugged using the excellent
<a class="cow-url" href="http://circuitlab.com/">CircuitLab</a>.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote6"></a>
<span class="cow-footnote-text" name="footnote6">This product may contain (or have been
written by) nuts.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote7"></a>
<span class="cow-footnote-text" name="footnote7">Bet you didn't know the logo incorporates a 3D buckyball. Like
I know what one is<span class="cow-footnote" name="footnote17"><sup><a href="#footnote17">17</a></sup></span>. Please don't tell my old chemistry teacher. Mind you, that was back
in the early 1930s, so buckyballs may not have been invented then. At lunch
time we used to go and suck on a piece of coal to take the hunger pangs off.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote8"></a>
<span class="cow-footnote-text" name="footnote8">Note that
we represent GPIO pins that are in input mode as ground in the diagrams &mdash;
strictly speaking this is inaccurate, but it does allow us to run simulations
on the circuits in CircuitLab. If you know a better way please let me know!</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote9"></a>
<span class="cow-footnote-text" name="footnote9">If your head is hurting, try slapping yourself sharply in the
face three times<span class="cow-footnote" name="footnote18"><sup><a href="#footnote18">18</a></sup></span>.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote10"></a>
<span class="cow-footnote-text" name="footnote10">The exact length of time before the wakeup call comes is
dependent on what else the machine is doing at the time.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote11"></a>
<span class="cow-footnote-text" name="footnote11">Note: don't position this
mat or the wires connecting to it anywhere that someone is likely to trip over
it. See also <a class="cow-url" href="#warning">this warning</a>. May contain nuts.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote12"></a>
<span class="cow-footnote-text" name="footnote12">This type of thing is commonly used in burglar alarm circuits.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote13"></a>
<span class="cow-footnote-text" name="footnote13">And not one called
<a class="cow-url" href="http://sillof.com/images/Customs/gilliam/tg-B-harry.jpg">Harry Tuttle</a>.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote14"></a>
<span class="cow-footnote-text" name="footnote14">The <a class="cow-url" href="http://www.arduino.cc/">Arduino</a> is
  an extremely capable device that is both fore-runner and partner to the Pi.
  Based on a micro-controller chip, Arduino has been a major driver of the
  wave of low cost, flexible and open hardware on whose crest the Pi is now
  riding. It has a larger set of interaction functions (higher power and
  better safeguarded than on the Pi), but is a bit less powerful and
  general-purpose from a computational point-of-view. No doubt both will
  co-exist, and a good number of projects combining them are already
  available.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote15"></a>
<span class="cow-footnote-text" name="footnote15">I never knew, for
  example, that in terms of the movement of electrons electricity flows
  backwards from negative to positive, and that the conventional reverse flow
  is just that &mdash; a convention dating back to a
  <a class="cow-url" href="http://www.allaboutcircuits.com/vol_1/chpt_1/7.html">mistaken conjecture</a>
  by Benjamin Franklin. Well I never!</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote16"></a>
<span class="cow-footnote-text" name="footnote16">If you really want to get in deep, here
are two comprehensive sources: <a class="cow-url" href="http://www.allaboutcircuits.com/">All About
Circuits</a>; the <a class="cow-url" href="https://6002x.mitx.mit.edu/">MIT Circuits and Electronics</a>
starter course in electrical engineering.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote17"></a>
<span class="cow-footnote-text" name="footnote17">And to think I work just round the corner from the
<a class="cow-url" href="http://www.sheffield.ac.uk/kroto/about-harry-kroto">Kroto institute</a>. Shame
on me.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote18"></a>
<span class="cow-footnote-text" name="footnote18">This probably won't help, but it will be amusing for
anyone who's watching.</span>
</li>
</ol></p>
</span>
</body></html>
