<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html><head>

<meta name="slug" contents="piroomba" />
<meta name="category" contents="Tutorials" />
<meta name="author" contents="Peter Wallis" />
<meta name="summary" contents="PiRoomba" />
<meta name="date" contents="2013-05-16 15:59" />

<title>PiRoomba</title>
</head>
<body>
<p><em><a href="http://www.cfpm.org/~peter/">Peter Wallis</a>, May 16th
2013.</em></p>

<p>
The Roomba is a domestic robot vacuum cleaner made by iRobot, the
company set up by Rodney Brooks and others from MIT in 1990.  I have a
Roomba 530 with a serial interface and open API as specified <a
href="http://www.cfpm.org/~peter/iRobot_Roomba_500_Open_Interface_Spec.pdf">here</a>.  Looking at
the API one can see Brooks' legacy in that it has "behaviours" that
can be turned on and off (<code>clean spot max dock</code>) as well as
the basic control of the drive wheels and cleaning motors.  The
company has done a great job of making robot hardware available to
hackers, but what can we do with it?
<h2>Add a <a href="http://www.raspberrypi.org/quick-start-guide">
Raspberry Pi</a> to the Roomba</h2>
<img src="images/roopiTop.jpg" alt="A raspberry pi on a Roomba - top
view" width="33%"/>
<img src="images/roopiSide.jpg" alt="A raspberry pi on a Roomba - side
view" width="33%"/>
<p>
I have put the pi in a plastic case that is connected to the bumper.
That way when it goes under a chair and catches the case, the force is
transmitted to the bump sensors and the standard software figures out
what to do.
<p>
<img src="images/plug.jpg" alt="The home made 7 pin DIN plug"
width="44%" align="right"/>
Unfortunately the clear plastic bowl I could get to cut
down was slightly too small and so I ended up making a 7 pin DIN plug
out of a piece of brass tube, some bass wire and some epoxy putty from
the local hobby shop.  The process was to solder the wires onto the
pins, take the battery out of the Roomba and put vaseline on the
serial plug on the Roomba. Put the pins (and earth ring) in the Roomba
socket, and then push putty over the top of the pins.  When it
dries, take the plug out (carefully) and "back fill" the plug from the
pin side and push it back into its vaseline covered socket.  Let it
dry and clean up.
<p>
<img src="images/powerBrd.jpg" alt="The pi - Roomba interface board"
width="44%" align="right"/>
There are two electrical challenges.  First the serial interface to
the rpi is 3.3v and the serial interface to the Roomba is 5v.  To
address this I simply used a voltage divider on the Roomba TxD to rpi
RxD connection (see circuit below).  The rpi TxD to Roomba RxD
connection is fine as 3.3v seems to be enough to drive the Roomba RxD
signal.
<p>
<br/>
<img src="images/rooPieCircuit.png" alt="The pi - Roomba interface board
circuit" width="400px" align="left"/>
The second challenge is that, although there 18-14v available directly
from the Roomba battery via the serial plug, there is a 200mA poly
fuse on that supply and the Pi draws up to 700mA. It actually only
draws 330 mA when running but around 420 on boot.  The difference
between what it normally draws and the specified required current is
to drive things hanging off the USB ports.  The solution was to use a
DC to DC converter (available through Farnell in the UK) that would
provide 400mA.  This turns out to be enough to boot and so my 4
rechargeable batteries are redundant until I put something weighty on
the USB connections.  Here is the circuit I used - there are some
strange choices (the inductor is surface mount; the schottky diode is
too big ...) but these decisions were based on what I had and could
get.  The original idea was to tune the potentiometer to deliver a
trickle charge (via a current regulator) to the batteries and have the
the power to the pi go via a voltage regulator. This doesn't work as I
don't seem to be able to find a voltage regulator that will take 5.45v
down to between 4.8 and 5.2 volts.  Please mail me if you have any
suggestions.
<p>
Finally the code. I have written (most) of the Roomba Open Interface
as a Java package that uses RXTX behind the scenes to communicate with
the robot.  The code is fairly trivial but one never has to think
about shift operators again.  The source is available for download
<a href="TODO">here</a>.

<h1>And so what?</h1>
With this type of set up we can work on all sorts of cool stuff:
<ul>
<li>make maps of your rooms</li>
<li>respond to voice control ("go away"; "chase me!"; "go to sleep")</li>
<li>teach basic AI search algorithms, robotics and the like</li>
</ul>

I am currently working on the SLAM problem - can it make a map of our front
room - but this is primarily to test the software package.  Soon I will start
on  some auditory processing but mail me links if you have a completed project
I should link to.

<h2>Challenge 1: Simultaneous Location and Mapping (SLAM)</h2>
Two sensor packets are the derived from the wheel odometer readings
and are the distance travelled since the last request for the data and
the angle through which the robot has turned.  Odometer readings are
not reliable but there is some interesting things that can be done
with respect to theory generation and reasoning in terms of
probabilities.

<h2>Challenge 2: Vision</h2>
<ul>
<li>Face recognition seems to work well and so individuals might be
recognised directly... (a good excuse to buy one of the the <a
href="http://www.raspberrypi.org/archives/3890">Raspi camera module</a>s!)
<li>Optical flow is well understood as an approach to measuring distance
to an object and "exceptional behaviour" might cause the machine to
stop and watch for movement.  Don't know...
</ul>

<h2>Challenge 3: Sound</h2>
Speech recognition works well in a quiet environment where the
microphone is close to the speaker.  A microphone on a working Roomba
is not like this, and putting an iPhone on it and using Siri is not
going to work.  But what we'd want a Roomba to hear is not
necessarily complex - what a dog understands would be plenty to
produce interesting human-robot interaction.  The issue I'd really
like to see solved is for the machine to be able to localise sound
sources...
</body>
</html>
