<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name = "viewport" content = "width = device-width">
  <title>PiCam &mdash; a Camera in a Lunchbox</title>

  <link rel="stylesheet" href="/theme/css/main.css">
  <link href="https://pi.gate.ac.uk/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Pi GATE â€” Sheffield Pi-Tronics Atom Feed" />

  <link rel="stylesheet" href="/theme/css/gatepage.css">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

  <!--[if IE]>
    <script src="/theme/js/html5shiv-googlecode-com-html5.js"></script>
  <![endif]-->
  <!--[if lt IE 7]>
    <style type="text/css" media="screen">
    body {
      behavior: url('/theme/images/menu/csshover.htc');
      font-size: 100%;
    }
    </style>
    <link rel="stylesheet" href="/theme/css/ie-menus.css" />
  <![endif]-->

  <!-- workaround for sup styling prob in default pelican theme -->
  <style type="text/css"> sup {font-size: 80%; position: relative; bottom: .8ex;} </style>

  <!-- menu accessibility fix from ian -->
  <!-- <script src="//ajax.googleapis.com/ajax/libs/prototype/1.7.1.0/prototype.js"></script> -->
  <script src="/theme/js/prototype-171-min.js"></script>
  <script src="/theme/js/gatepage.js"></script>

  <!-- yui grids -->
  <link rel="stylesheet" type="text/css" href="/theme/css/cssgrids-min.css">
  <link rel="stylesheet" type="text/css" href="/theme/css/cssgrids-responsive-min.css">
  <!-- from: http://yui.yahooapis.com/3.10.3/build/cssgrids/cssgrids-min.css
             http://yui.yahooapis.com/3.10.3/build/cssgrids-responsive/cssgrids-responsive-min.css -->
</head>

<body id="index" class="home">
<div class='yui3-g-r'>
  <div id="leftColumn" class="yui3-u-1-2" style="width: 90%"> <!-- column 1 -->
        
<section id="content" class="body">    
    <h1 class="entry-title">PiCam &mdash; a Camera in a Lunchbox</h1>
<div id="socialButtons">
  <span><a href="http://twitter.com/share?text=Pi.GATE.ac.uk %20@PiTronics&url=https://pi.gate.ac.uk/pages/snowcam.html"
           target="_blank" title="Tweet this page"><img src="/theme/images/tweet.png"
           height="30" width="30"></a></span>
  <span><a href="https://pi.gate.ac.uk/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
           title="Syndication feed"><img
           height="28" width="28" src="/theme/images/icons/rss-large.jpg"/></a></span>
  <span>&nbsp;<a href="/pages/snowcam.html#disqus_thread"
           title="Leave a comment"><img
           src="/theme/images/comment.png" height="30" width="30"></a></span>
  <span>&nbsp;<a href="/print/pages/snowcam.html"
           title="Print"><img
           src="/theme/images/print.png" height="30" width="30"></a></span>
</div>    
    

<p><em>A programmable camera and web server</em></p>


<p><em><a class="cow-url" href="/pages/about.html#hamish">Hamish Cunningham</a>), September 2013</em></p>

<p><hr></p>
<!--% TODO-->
<h1 class="cow-heading">DRAFT, unfinished</h1>

<!--
Tech TODOs
- call setsid to begin with and record the group, then use pkill -P ppid to
  kill all the children on exit
- try the tips at
  http://www.raspberrypi-spy.co.uk/2012/11/cheap-miniature-lcd-screen/
- try script:
  http://stackoverflow.com/questions/1401002/trick-an-application-into-thinking-its-stdin-is-interactive-not-a-pipe
-->
<p><hr></p>

<div class="cow-contents"><h2 class="cow-heading">Contents</h2>
<p><ul>
<li><a href="#section-1.">1. Introduction</a></li>
<li><a href="#section-2.">2. Building It</a></li>
<li>&nbsp;&nbsp;<a href="#section-2.1.">2.1. Connect the Camera</a></li>
<li>&nbsp;&nbsp;<a href="#section-2.2.">2.2. Prepare the Pi</a></li>
<li>&nbsp;&nbsp;<a href="#section-2.3.">2.3. Connecting (and Modifying) the Screen</a></li>
<li>&nbsp;&nbsp;<a href="#section-2.4.">2.4. Wire up the Header Pins</a></li>
<li>&nbsp;&nbsp;<a href="#section-2.5.">2.5. Devil Worship for Photographers</a></li>
<li><a href="#section-3.">3. In the Wild</a></li>
</ul></p></div>

<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-1."></a><h1 class="cow-heading"><span class="cow-sec-number">1. </span>Introduction</h1>

<p>Here it is: a 5 mega-pixel still picture and HD video camera for less than
what I spend on coffee in a bad week.</p>

<p><img class="cow-img" src="/pages/images/cam-01.jpg" alt="The Pi camera module" width="400" height="300"></p>

<p>The camera comes attached to a thin ribbon cable about 15 centimetres long and
hooks up directly onto the Pi circuit board. And you can program it! You can
tweak it! You can rip the front off, slice off the filter and get it to work
on infra-red<span class="cow-footnote" name="footnote1"><sup><a href="#footnote1">1</a></sup></span>!</p>

<p>You can also, of course, stick it inside a small cuddly animal and send it
into the stratosphere <a class="cow-url" href="http://www.bbc.co.uk/news/technology-23840596">hanging
from a balloon</a>:</p>

<p><img class="cow-img" src="/pages/images/babbage.jpg" alt="Babbage bear preparing to fly" width="375" height="500"></p>

<p>But you knew that, I'm sure.</p>

<p>This page is about putting a camera in a box, with a screen, and serving the
pictures taken direct onto the web.</p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-2."></a><h1 class="cow-heading"><span class="cow-sec-number">2. </span>Building It</h1>

<p>How do you build a statue of an elephant? First take one large grey block of
stone<span class="cow-footnote" name="footnote2"><sup><a href="#footnote2">2</a></sup></span>:</p>

<p><img class="cow-img" src="/pages/images/rosetta.jpg" alt="A large grey block of stone" width="343" height="250"></p>

<p>Then carefully chip away all the bits that don't look like an elephant. (I
didn't study art, by the way &mdash; I'm entirely self-taught!)</p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-2.1."></a><h2 class="cow-heading"><span class="cow-sec-number">2.1. </span>Connect the Camera</h2>

<p>The first step is to install the camera. There's a handy video here &mdash;
<a class="cow-url" href="http://www.raspberrypi.org/camera">raspberrypi.org/camera</a> &mdash; but the main
things to remember are:</p>

<ul>
<li>the camera is vulnerable to static &mdash; if your hair is in the habit of
  standing on end when you walk across the carpet then you might want to hug a
  radiator or a lightening conductor or the like before starting (or go all
  professional on us and use an earth strap)</li>
<li>the camera slots into S5, the long connector sitting between the HDMI socket
  and the ethernet socket (or the space for it, on the Model A)</li>
<li>before inserting the cable you need to a) unpeel the small piece of
  protective on the top, and b) gently ease up the restraining clip on the top</li>
<li>the blue face of the ribbon cable faces the ethernet connector</li>
<li>when the cable is well seated and straight in the slot of the connector,
  ease the restraining clip down again</li>
</ul>

<p>Hey presto.</p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-2.2."></a><h2 class="cow-heading"><span class="cow-sec-number">2.2. </span>Prepare the Pi</h2>

<p>Fire up your Pi and, if you haven't done it recently, update your list of
software packages, upgrade any that have new versions available, and reboot:</p>

<p><pre class="prettyprint lang-bash">
  sudo apt-get update
  sudo apt-get upggrade
</pre>TODO</p>
<ul>
<li>install and configure pagekite</li>
<li>install pi-cam (will pull in imagemagick etc.) and apache</li>
</ul>

<p>Now enable the camera module using the <tt>raspi-config</tt> programme and reboot.</p>

<p><pre class="prettyprint lang-bash">
  raspi-config
  sudo shutdown -r now
</pre>Our Pi is prepared.</p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-2.3."></a><h2 class="cow-heading"><span class="cow-sec-number">2.3. </span>Connecting (and Modifying) the Screen</h2>

<p><a class="cow-url" href="http://www.raspberrypi.org/phpBB3/viewtopic.php?t=17651">http://www.raspberrypi.org/phpBB3/viewtopic.php?t=17651</a></p>

<p><pre class="prettyprint lang-bash">
framebuffer_width=320   # the device resolution is 640x480;
framebuffer_height=240  #   half of that provides good readability
disable_overscan=0
overscan_left=-20
overscan_right=-20
overscan_top=-20
overscan_bottom=-20
</pre></p><!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-2.4."></a><h2 class="cow-heading"><span class="cow-sec-number">2.4. </span>Wire up the Header Pins</h2>

<table>
<tr><td> <b>Jumper cable</b></td><td> <b>Function</b>    </td><td> <b>Pin Number</b>  </td><td> <b>Role</b>                </td></tr>
<tr><td> red           </td><td> 5v out        </td><td>  2            </td><td> screen power          </td></tr>
<tr><td> green         </td><td> GPIO 0        </td><td> 11            </td><td> still / video switch  </td></tr>
<tr><td> blue          </td><td> GPIO 2        </td><td> 13            </td><td> pic switch            </td></tr>
<tr><td> purple        </td><td> GPIO 3        </td><td> 15            </td><td> power switch          </td></tr>
<tr><td> black         </td><td> 0v            </td><td> 20            </td><td> ground                </td></tr>
</table>

<!-- UNUSED
%[
---
| grey          | (unused)      | %\ -          | %\ -                  |
---
| white         | (unused)      | %\ -          | %\ -                  |
---
| orange        | 5v in         |  4            | power from battery    |
---
| yellow        | 0v            |  6            | power from battery    |
%]
-->


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-2.5."></a><h2 class="cow-heading"><span class="cow-sec-number">2.5. </span>Devil Worship for Photographers</h2>

<p>prob just reference <a class="cow-url" href="/pages/package.html">packaging</a></p>

<ul>
<li>from fred re. thumbnails:
  <ul>
  <li>Usually an image is resized using just the -geometry option:
    <ul>
    <li>convert in.jpg -geometry 25% out.jpg</li>
    </ul></li>
  <li>This results in a very nice resize but it's fairly CPU intensive. It takes
    about 145 ms on my desktop. The command uses some sort of clever maths
    which I'm not going to bother finding the details of, but sufficed to say
    it's not a simple interpolation scheme, but some sort of matrix
    transformation. It is possible to tell convert to use a simple
    interpolation scheme to resize though:
    <ul>
    <li>convert in.jpg -interpolate integer -interpolative-resize 25% out.jpg</li>
    </ul></li>
  <li>This tells it to use the pixel nearest the interpolated coordinate
    according to floor() rounding. It takes about 47 ms on my desktop, but
    visually the image quality is a bit worse - there are signs of aliasing
    etc. The only simple interpolation scheme that doesn't have this is this
    one:
    <ul>
    <li>convert in.jpg -interpolate average16 -interpolative-resize 25% out.jpg</li>
    </ul></li>
  <li>This is as it sounds an are average of surrounding pixels. Still a
    relatively straight forward operation though as it only takes around 80 ms
    on my desktop. I think it's the best compromise. The timings of course
    depend on the original image size, but they illustrate the differences. As
    the scale size goes down, e.g. to 5%, the time to resize decreases.</li>
  </ul></li>
</ul>


<p>if the daemon throws a wobbler and raspivid refuses to run without timeout,
try</p>

<p><pre class="prettyprint lang-bash">
@reboot /bin/bash -c &quot;cd /home/pi/pi-tronics/pi-cam &amp;&amp; /usr/bin/sudo ./pi-cam -c&quot;
</pre>in .crontab</p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-3."></a><h1 class="cow-heading"><span class="cow-sec-number">3. </span>In the Wild</h1>

<p>While I was photographing the 001 incarnation, a small visitor passed by:</p>

<p><img class="cow-img" src="/pages/images/snowcam/001/p1010944.jpg" alt="A hedgepig!" width="500"></p>

<p>TODO resize, add thumb</p>
<span class="cow-footnote-section">
<h1 class="cow-heading">Footnotes</h1>
<p><ol>
<li>
<a class="cow-footnote-anchor" name="footnote1"></a>
<span class="cow-footnote-text" name="footnote1">There's now a special
<a class="cow-url" href="http://www.raspberrypi.org/archives/5128">Pi NoIR version</a> of the camera
available without the filter. Getting the original camera to work for
infra-red
<a class="cow-url" href="http://hackaday.com/2013/05/27/adding-night-vision-to-the-raspberry-pi-camera/">is</a>
<a class="cow-url" href="http://www.raspberrypi.org/archives/4088">described</a>
<a class="cow-url" href="http://www.imaging-resource.com/news/2013/06/06/under-the-microscope-raspberry-pi-camera-dissected-given-infrared-vision">here</a>.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote2"></a>
<span class="cow-footnote-text" name="footnote2">Though perhaps not <em>this</em> one, which some people are quite fond
of. It used to belong to someone called Rosetta, apparently.</span>
</li>
</ol></p>
</span>
<script src="https://google-code-prettify.googlecode.com/svn/loader/run_prettify.js"></script>

</section>

</div>
