<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name = "viewport" content = "width = device-width">
  <title>PiRoomba</title>

  <link rel="stylesheet" href="/theme/css/main.css">
    <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Pi GATE — Sheffield Pi-Tronics Atom Feed" />
    
  <!-- replace with version in static/css/gatepage.css?
  <link rel="stylesheet" href="http://gate.ac.uk/css/page.css"> -->
  <link rel="stylesheet" href="/theme/css/gatepage.css">
  <link rel="shortcut icon" href="http://pi.gate.ac.uk/favicon.ico" type="image/x-icon">

  <!--[if IE]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
  <![endif]-->

  <!-- replace with versions in static/css? -->
  <!--[if lt IE 7]>
    <style type="text/css" media="screen">
    body {
      behavior: url('http://gate.ac.uk/_images/menu/csshover.htc');
      font-size: 100%;
    }
    </style>
    <link rel="stylesheet" href="http://gate.ac.uk/css/ie-menus.css" />
  <![endif]-->

  <!-- workaround for sup styling prob in default pelican theme -->
  <style type="text/css">
    sup {font-size: 80%; position: relative; bottom: .8ex;}
  </style>

  <!-- sharethis -->
  <script type="text/javascript">var switchTo5x=true;</script>
  <script type="text/javascript" src="http://w.sharethis.com/button/buttons.js"></script>
  <script type="text/javascript">stLight.options({publisher: "e5977250-e340-464c-922e-c1b521b27184", doNotHash: false, doNotCopy: false, hashAddressBar: false});</script>

  <!-- yui grids -->
  <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.10.3/build/cssgrids/cssgrids-min.css">
  <link rel="stylesheet" type="text/css" href="http://yui.yahooapis.com/3.10.3/build/cssgrids-responsive/cssgrids-responsive-min.css">
</head>

<body id="index" class="home">
  <div id="topBar">
    <span id="topLogo">
      <span id="piLogo"><a href="http://raspberrypi.org/"><img src="/theme/images/raspi-logo.png" alt="Raspberry Pi" border="0" height="55"></a></span>
      <span id="strapLine"><a href="/">Pi-Tronics from<br/>the GATE people</a></span>
      <span id="gateLogo"><a href="http://gate.ac.uk/"><img src="/theme/images/logo-gate.png" alt="GATE" border="0" height="55"></a></span>
      <!-- <a href="http://www.shef.ac.uk/dcs/"><img src="/theme/images/logo-usfd-shield.png" alt="The University of Sheffield" height="55"></a> -->
    </span>
    <div class="horizontal menu">
    <ul>
    <li><img src="/theme/images/arrow-right.jpg"/></li>
    <!-- TODO need a page at /pages to link from the top level here -->
    <!--
    <li><b><a href="">Projects</a></b>
      <ul>
    -->
                                      <li><a href="/pages/basics.html">Basics</a></li>
                                <li><a href="/pages/hardware.html">Hardware</a></li>
                                <li><a href="/pages/legocases.html">LEGOCases</a></li>
                                <li><a href="/pages/notipi.html">NotiPi</a></li>
                                <li><a href="/pages/piroomba.html">PiRoomba</a></li>
                                <li><a href="/pages/schools.html">Schools</a></li>
                  <!--
      </ul></li>
    -->
    <!-- <li><a href="/category/news.html">News</a></li> -->
    <li><a href="/pages/about.html">About</a></li>
    </ul>
    </div>
    
    <!-- first row header links -->
    <div id="topLoginEtc">
      <form name="searchForm" method="GET" action="http://www.google.com/search" class="inlineForm">
        <label class="pageLink" for="as_q">Search:</label>
        <input type="text" name="as_q" size="6" maxlength="255">
        <input type="hidden" name="as_sitesearch" value="pi.gate.ac.uk">
      </form>
    </div>
  </div>

  <!-- header menus -->
  <div id="header">
  </div>

  <!-- sep, left/right bars, body and footer -->
  <div id="topSeparator"> </div>

  <!-- main content div -->
  <div id="mainContent">

<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
  <!--
  <header id="banner" class="body">
    <nav>
    <ul>
                <li><a href="/pages/about.html">About</a></li>
            <li><a href="/pages/basics.html">Basics</a></li>
            <li><a href="/pages/hardware.html">Hardware</a></li>
            <li><a href="/pages/legocases.html">LEGOCases</a></li>
            <li><a href="/pages/notipi.html">NotiPi</a></li>
            <li><a href="/pages/piroomba.html">PiRoomba</a></li>
            <li><a href="/pages/schools.html">Schools</a></li>
                    <li ><a href="/category/news.html">News</a></li>
            </ul>
    </nav>
  </header>
  -->
  <!-- /#banner -->
<div class='yui3-g-r'>
  <div id="leftColumn" class="yui3-u-1-2"> <!-- column 1 -->
          
<section id="content" class="body">    
    <h1 class="entry-title">PiRoomba</h1>
<div id="socialButtons">
  <span class='st_twitter_large' st_via='hcunningham' displayText='Tweet'></span>
  <span class='st_identi_large' displayText='identi.ca'></span>
  <span class='st_email_large' displayText='Email'></span>
  <span class='st_sharethis_large' displayText='ShareThis'></span>
  <span class='st_linkedin_large' displayText='LinkedIn'></span>
  <span class='st_googleplus_large' displayText='Google +'></span>
  <span class='st_facebook_large' displayText='Facebook'></span>
  <span class='st_citeulike_large' displayText='CiteULike'></span>
  <span class='st_tumblr_large' displayText='Tumblr'></span>
  <span><a href="/feeds/all.atom.xml"
    type="application/atom+xml" rel="alternate">
      <img height="30" src='/theme/images/icons/rss-large.jpg'/>
    </a></span>
</div>        
        
<p><em><a class="cow-non-existant-url" href="/pages/about.html#pete">Peter Wallis</a>, June 20th 2013</em></p>

<h1>Piroomba - controlling a Roomba with a raspberry pi</h1>
<p>
<img src="/static/pages/images/Roomba3g.jpg" attr="Creative Commons 'Roomba3g.jpg'" alt="A Roomba 530 on its charge station." align="right" width="30%">
I have put a <a href="http://www.raspberrypi.org/">raspberry pi</a> on my 
<a href="http://en.wikipedia.org/wiki/Roomba">Roomba</a>.  Below you
will find links to how, but this page deals with the why.
</p><p>
The Roomba is a
autonomous robot vacuum cleaner that can can be bought on line or, on
occasion, from department stores.  The machine has an interesting
history in that it is manufactured by <a href="http://www.irobot.com/global/en/explore_irobot/government_industrial_robots.aspx">iRobot</a>, the company set up by <a href="http://people.csail.mit.edu/brooks/">Rodney Brooks</a> and
others from MIT in the 1990's.  The company has sold around six
million Roombas[<a href="http://en.wikipedia.org/wiki/Roomba">1</a>] and the machine has
in effect defined its own market with several imitations now available.
Today however iRobot is probably more famous for producing the <a href="http://en.wikipedia.org/wiki/PackBot">Packbot</a> series of
military remote control robots  -- time for a quick visit to the campaign to 
<a href="http://www.stopkillerrobots.org/">stop killer robots</a>?
</p>
<p>
The illustrious pedigree of the Roomba is evident in the way it works.
The Roomba does not map the
room but rather performs a semi random walk that is likely to cover
any given spot multiple times (see time lapse photo).  With no sense
of location, the roomba is often seen as little more than a toy by
computer scientists but there are historical reasons for the Roomba to
take this approach.  Ignoring the history is of course likely to lead
to one repeating it.
<img src="/static/pages/images/800px-Roomba_time-lapse.jpg" attr="Chris Bartle Creative Commons 'Roomba time-lapse.jpg'" alt="A time-lapse photo of the roomba's path" width="92%">
</p>
<p>
There are three good reasons for using a Roomba as the basis of
serious robot research:
</p><ul>
<li>iRobot is really good at producing a <b>robust platform with useful
accessories</b>.
My Roomba is currently sitting on its charging platform and later
today will clean the front room floor.  It is a system that regularly
runs for <i>years</i> rather than minutes.  The system is well made
with spares available. Indeed my Roomba is a second hand unit that was
suffering the "<a href="http://www.schneordesign.com/Avi/irobot/roomba_mod2.htm"> 9 beep dance</a>".
I fixed it with a soldering iron and a 60p component from Maplin
Electronics.  The thing has been chased by the children, dropped (not
too far) and tells me when it needs a clean.  What you get with a
Roomba is something with lots of development behind it.
</li><li>The Roomba has an application that means it is <b>always on</b>.  
You get all the above if you buy a <a href="http://en.wikipedia.org/wiki/IRobot_Create">iRobot Create</a>
but if I was using a Create, why would I leave it on?
Like <a href="http://cfpm.org/%7Epeter/OldWebpage/index.html">my previous robots</a>, there is no doubt something I made with
the Create would end up being disassembled or in the back of a
cupboard with the batteries out.  My Roomba is there and I am
continually temped to modify it.

</li><li>Having an application means that Roombas provide a pathway to
addressing a fundamental question in <b>language &amp; representation</b>.
Many robot people have the naïve idea that things
in the robot's environment can be represented with arbitrary symbols.
It turns out that `symbol grounding' (not really the right term) happens
through our experience of the world and that experience is determined by
embodiment.  By the 1980's AI research realised the reference model of
meaning failed surprisingly quickly when moves out of a "blocks world,"
but what could we do about it?  The issue has a long history going
back at least Heidegger and Witgenstein, extending through to Gibson's
notion of affordances, to Lakoff &amp; Johnson's notion of metaphor,
and to Ruthrof's "semantics of the body".
How this thinking links into serious robot research is an on going issue.
</li></ul>
The link however does bring us back to an interesting feature of the
Roomba.  There is a problem with representation and Brooks grand
agenda (in the early days at least) was to see what could be done
<a href="http://citeseerx.ist.psu.edu/viewdoc/summary?doi=10.1.1.12.1680">without representation</a>.  The Roomba's random walk is not a quick
fix that ought to be replaced with an algorithm based on some sort of
map, but rather it is a considered solution to a classic problem.
Indeed when one looks at the Roomba Open Interface, the
architecture is very much <a href="http://mitpress.mit.edu/books/behavior-based-robotics/">Behaviour Based Robotics</a>
with "primitive" commands for "clean", "seek dock" and so on. In the
same way one might like to start with two motors and a chassis and not
use the excellent work done by iRobot to make a Roomba, one could also
throw out their excellent work on the application/architecture and use
a iRobot Create.  I however think the Roomba is a better place to
start thinking about robotics.
<p></p>
<p>
</p>


<h1>Connecting a Pi to the Roomba</h1>
<img src="/static/pages/images/roopiTop.jpg" alt="A raspberry pi on a Roomba - top view" width="33%">
<img src="/static/pages/images/roopiSide.jpg" alt="A raspberry pi on a Roomba - side
view" width="33%">
<p>
I have a Roomba 530 with a serial interface and open API as specified
<a href="http://cfpm.org/%7Epeter/bfz/iRobot_Roomba_500_Open_Interface_Spec.pdf">here</a>.
Connecting the pi requires a serial connection between the pi an the
roomba's serial port, and some way of powering the pi from the 18volt
supply on the roomba.
I have put the pi in a plastic case that is connected to the bumper.
That way when it goes under a chair and catches the case, the force is
transmitted to the bump sensors and the standard software figures out
what to do.
</p><p>
<img src="/static/pages/images/plug.jpg" alt="The home made 7 pin DIN plug" align="right" width="44%">
Unfortunately the clear plastic bowl I could get to cut
down was slightly too small and so I ended up making a 7 pin DIN plug
out of a piece of brass tube, some bass wire and some epoxy putty from
the local hobby shop.  The process was to solder the wires onto the
pins, take the battery out of the Roomba and put vaseline on the
serial plug on the Roomba. Put the pins (and earth ring) in the Roomba
socket, and then push putty over the top of the pins.  When it
dries, take the plug out (carefully) and "back fill" the plug from the
pin side and push it back into its vaseline covered socket.  Let it
dry and clean up.
</p><p>
<img src="/static/pages/images/powerBrd.jpg" alt="The pi - Roomba interface board" align="right" width="44%">
There are two electrical challenges.  First the serial interface to
the rpi is 3.3v and the serial interface to the Roomba is 5v.  To
address this I simply used a voltage divider on the Roomba TxD to rpi
RxD connection (see circuit below).  The rpi TxD to Roomba RxD
connection is fine as 3.3v seems to be enough to drive the Roomba RxD
signal.
</p><p>
<img src="/static/pages/images/RooPieCircuit.png" alt="The pi - Roomba interface board
circuit" align="left" width="200px">
The second challenge is that, although there 18-14v available directly
from the Roomba battery via the serial plug, there is a 200mA poly
fuse on that supply and the Roomba draws up to 700mA. It actually only
draws 330 mA when running but round 420 on boot.  The difference
between what it normally draws and the specified required current is
to drive things hanging off the USB ports.  The solution was to use a
DC to DC converter (available through Farnell in the UK) that would
provide 400mA.  This turns out to be enough to boot and so my 4
rechargeable batteries are redundant until I put something weighty on
the USB connections.  Here is the circuit I used - there are some
strange choices (the inductor is surface mount; the schottiky diode is
too big ...) but these decisions were based on what I had and could
get.  The original idea was to tune the potentiometer to deliver a
trickle charge (via a current regulator) to the batteries and have the
the power to the pi go via a voltage regulator. This doesn't work as I
don't seem to be able to find a voltage regulator that will take 5.45v
down to between 4.8 and 5.2 volts.  Please mail me if you have any
suggestions.
</p><p>
Finally the code. I have written (most) of the Roomba Open Interface
as a Java package that uses RXTX behind the scenes to communicate with
the robot.  In addition I have written a user interface that provides
a "joystick" to steer the roomba, and a set of level meters that indicate
the output from the 6 "light bump sensors":

<img src="/static/pages/images/remoteControl.jpg" alt="my laptop running
the Roo Pie remote control interface with the roomba finding the sofa.">
<br>
The code is in Java and uses Sockets to communicate between a computer
running the user interface and the rpi, and RXTX to communicate
between the rpi and the roomba.
The code is available for download <a href="http://cfpm.org/%7Epeter/PetersSourceCode.tar">here</a> as a tar ball.

</p>


</section>

</div>
<!-- <div id="emptyMiddleColumn" class="yui3-u-1-24"> --> <!-- column 2 -->
  <section id="extras" class="body">
      </section><!-- /#extras -->


  </div>
  </div>

<!-- %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% -->
  </div> <!-- #mainContent -->

  <div id="footer">
    <table border="0" align="right"><tbody><tr>
      <td style="vertical-align:bottom; text-align:right;">
      <font size="-2">
        © The <a href="http://www.shef.ac.uk/">University of Sheffield</a>, 1995-2013.<br/>
        This website is licenced under the
        <a rel="license"
        href="http://creativecommons.org/licenses/by-nc-sa/3.0/">Creative Commons Attribution-NonCommercial-ShareAlike Licence</a>.<br/>
        <a href="http://gate.ac.uk/">GATE</a> is <a href="http://www.fsf.org/">free software</a> under
        <a href="http://www.gnu.org/licenses/">the GNU licences</a> and
        others. All our products and services supplied <b>with no warranty</b>.<br/>
        <em>Raspberry Pi</em> and the Raspberry Pi logo are trademarks of the <a href="http://www.raspberrypi.org/">Raspberry Pi Foundation</a>.
      </font>
      </td>
      <td style="vertical-align:bottom;"><a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/3.0/"><img alt="Creative Commons License" style="border-width: 0pt;" src="/theme/images/cc-by-nc-sa.png"></a><br/><br/>
      </td>
      <td>
        <a href="http://www.shef.ac.uk/dcs/"><img src="/theme/images/logo-usfd.png" alt="The University of Sheffield" height="70"</a>
      </td>
    </tr>
    </tbody></table>
  </div>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  ga('create', 'UA-41812045-1', 'gate.ac.uk');
  ga('send', 'pageview');
</script>
</body>
</html>