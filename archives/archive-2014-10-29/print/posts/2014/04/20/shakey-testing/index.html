<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name = "viewport" content = "width = device-width">
  <title>Wobbling, Coding, Wobbling, Testing</title>

  <link rel="stylesheet" href="/theme/css/main.css">
    <link href="https://pi.gate.ac.uk/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="Pi GATE — Sheffield Pi-Tronics Atom Feed" />
    
  <link rel="stylesheet" href="/theme/css/gatepage.css">
  <link rel="shortcut icon" href="/favicon.ico" type="image/x-icon">

  <!--[if IE]>
    <script src="/theme/js/html5shiv-googlecode-com-html5.js"></script>
  <![endif]-->
  <!--[if lt IE 7]>
    <style type="text/css" media="screen">
    body {
      behavior: url('/theme/images/menu/csshover.htc');
      font-size: 100%;
    }
    </style>
    <link rel="stylesheet" href="/theme/css/ie-menus.css" />
  <![endif]-->

  <!-- workaround for sup styling prob in default pelican theme -->
  <style type="text/css"> sup {font-size: 80%; position: relative; bottom: .8ex;} </style>

  <!-- menu accessibility fix from ian -->
  <!-- <script src="//ajax.googleapis.com/ajax/libs/prototype/1.7.1.0/prototype.js"></script> -->
  <script src="/theme/js/prototype-171-min.js"></script>
  <script src="/theme/js/gatepage.js"></script>

  <!-- yui grids -->
  <link rel="stylesheet" type="text/css" href="/theme/css/cssgrids-min.css">
  <link rel="stylesheet" type="text/css" href="/theme/css/cssgrids-responsive-min.css">
  <!-- from: http://yui.yahooapis.com/3.10.3/build/cssgrids/cssgrids-min.css
             http://yui.yahooapis.com/3.10.3/build/cssgrids-responsive/cssgrids-responsive-min.css -->
</head>

<body id="index" class="home">
<div class='yui3-g-r'>
  <div id="leftColumn" class="yui3-u-1-2" style="width: 90%"> <!-- column 1 -->
  <section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/posts/2014/04/20/shakey-testing/" rel="bookmark"
           title="Permalink to Wobbling, Coding, Wobbling, Testing">Wobbling, Coding, Wobbling, Testing</a></h1>
      <div id="socialButtons">
  <span><a href="http://twitter.com/share?text=Pi.GATE.ac.uk %20@PiTronics&url=https://pi.gate.ac.uk/posts/2014/04/20/shakey-testing/"
           target="_blank" title="Tweet this page"><img src="/theme/images/tweet.png"
           height="30" width="30"></a></span>
  <span><a href="https://pi.gate.ac.uk/feeds/all.atom.xml" type="application/atom+xml" rel="alternate"
           title="Syndication feed"><img
           height="28" width="28" src="/theme/images/icons/rss-large.jpg"/></a></span>
  <span>&nbsp;<a href="/posts/2014/04/20/shakey-testing/#disqus_thread"
           title="Leave a comment"><img
           src="/theme/images/comment.png" height="30" width="30"></a></span>
  <span>&nbsp;<a href="/print/posts/2014/04/20/shakey-testing/"
           title="Print"><img
           src="/theme/images/print.png" height="30" width="30"></a></span>
</div>    </header>

    <div class="entry-content">
      <footer class="post-info">
  <a class="article-thumb" href="/static/images/articles/shakey-testing.jpg"><img
    src="/static/images/articles/thumbs/shakey-testing.jpg"
    height="75" width="75" alt="shakey-testing"></a>
      <span class="article-summary"><em>Hot-swap, uninterruptible, multi-supply mobile power for the Raspberry Pi — and unlimited outdoor adventures!</em>.</span>
     <br/>     <!-- In <a href="/category/news.html">News</a> -->
    
  Tags:<span class="tag-list"> <a href="/tag/kickstarter.html">kickstarter</a> <a href="/tag/batteries.html">batteries</a> <a href="/tag/mo-pi.html">mo-pi</a> <a href="/tag/pi-tronics.html">pi-tronics</a> <a href="/tag/pi.html">pi</a> <a href="/tag/raspberrypi.html">raspberrypi</a> <a href="/tag/gate.html">gate</a>.</span>    <br/>   <span class="published" title="2014-04-20T00:00:00">Sun 20 April 2014,</span>
    <a class="url fn" href="/author/hamish-cunningham.html">Hamish Cunningham</a>.
  </footer><!-- /.post-info -->      
<h2 class="cow-heading">[MoPi is <b>mobile</b>, <b>hot-swap</b> and <b>24/7 power</b> for the Raspberry Pi.
<a class="cow-url" href="/pages/get-mopi.html">How to order.</a>]</h2>

<p><a class="cow-url" href="/static/images/mopi/first-boxed-batch-april-2014.jpg"><img class="cow-img" src="/static/images/mopi/first-boxed-batch-april-2014-500.jpg" alt="Boxed batch" width="500"></a></p>

<div class="cow-contents"><h2 class="cow-heading">Contents</h2>
<p><ul>
<li><a href="#section-1.">1. Waving, Drowning, or ...?</a></li>
<li><a href="#section-2.">2. MoPi v3 and v4: Results So Far</a></li>
<li><a href="#section-3.">3. Packaging</a></li>
<li><a href="#section-4.">4. Working with the New Board</a></li>
<li><a href="#section-5.">5. Linux is Lovely</a></li>
<li>&nbsp;&nbsp;<a href="#section-5.1.">5.1. Enabling I2C and Debugging with I2C Tools</a></li>
</ul></p></div>

<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-1."></a><h1 class="cow-heading"><span class="cow-sec-number">1. </span>Waving, Drowning, or ...?</h1>

<p>(With apologies to <a class="cow-url" href="http://www.bbc.co.uk/arts/poetry/outloud/smith.shtml">Stevie Smith</a>.)</p>

<p>Ok, so it was raining solidly for the second straight day of our (working)
holiday, but what the hell &mdash; I was tucked up in bed, and The Little Monster
was still asleep at gone 9 local time. Life was fine. And then I tried to sit
up, and the world started spinning. Hmmm. Not so fine.</p>

<p>Labyrinthitis is a murky syndrome involving the tiny hairs in your inner ear
that allow us to balance. If there's a change in the liquid that activates
them, then all sorts of wierd and wonderful things can happen &mdash; including
vertigo. A frequent result, apparently, is projectile oral expulsion of
whatever you've been scoffing recently &mdash; see for example
<a class="cow-url" href="http://www.pcarter.com.au/books/ride-like-hell-and-youll-get-there/">Paul
Carter's account</a><span class="cow-footnote" name="footnote1"><sup><a href="#footnote1">1</a></sup></span> &mdash; but lucky
for me I didn't go through that stage.</p>

<p>I do feel somewhat wobbly, though, and testing new versions of the MoPi
firmware from Lubo has been a bit tricky for the last few days...</p>

<p>All part of life's rich tapestry, no doubt. Onwards.</p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-2."></a><h1 class="cow-heading"><span class="cow-sec-number">2. </span>MoPi v3 and v4: Results So Far</h1>

<p>The good news is that we're pretty convinced that the
<a class="cow-non-existant-url" href="/posts/2014/03/27/pre-propduction-mopi/">version 3 prototype</a> is a solid
basis for the first full production run (version 4, which we'll be delivering
to our <a class="cow-url" href="http://kck.st/1gK5U3t">Kickstarter backers</a> in May and June). We've
ordered the PCBs and most of the components. (Below more details of the
development and testing process.)</p>

<p>The bad news is that there's a world-wide shortage of the Silicon Labs
microcontroller that we're using<span class="cow-footnote" name="footnote2"><sup><a href="#footnote2">2</a></sup></span> :-( <br> <br>
<img class="cow-img" src="/static/images/falling-shipping-containers.jpg" alt="Falling Shipping
Containers"><span class="cow-footnote" name="footnote3"><sup><a href="#footnote3">3</a></sup></span> <br> <br> &mdash; we've only
managed to order around half of what we need for immediate delivery. The other
half is on order for delivery in the first week of June. If the situation
stays the same then this means we will be delivering to the first half of our
backers in May and the second half in June. (We'll do this in
first-come-first-served order.)</p>

<p>If anyone has 300 spare controllers we'd love to hear from you...</p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-3."></a><h1 class="cow-heading"><span class="cow-sec-number">3. </span>Packaging</h1>

<p>Big thanks to Georgi Marinov from <a class="cow-url" href="http://www.engview.com/">EngView systems</a>
for designing a beautiful packet for MoPi:</p>

<p><img class="cow-img" src="/static/images/mopi/packaging-01.jpg" alt="The Packaging 1" width="500"></p>

<!--% %image(images/mopi/packet/img-20140421-112941.jpg, Packaging 2, 500)-->


<p>And you can also spot the new stackable headers version here (with a
stabilising device at the top which we'll ship it with &mdash; the long pins are
very easy to bend!).</p>

<!--% %image(images/mopi/packet/img-20140421-112958.jpg, Packaging 3, 500)-->


<p><img class="cow-img" src="/static/images/mopi/packet/img-20140421-113013.jpg" alt="Packaging 4" width="500"></p>

<p>Thanks Joro! (And thanks Gen for the logo!)</p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-4."></a><h1 class="cow-heading"><span class="cow-sec-number">4. </span>Working with the New Board</h1>

<p>Our present work has several objectives:</p>

<ul>
<li>verify that the new MoPi board implements all (old and new) functions
  correctly</li>
<li>develop an API for I2C access to the board</li>
<li>convert SimBaMon to use the new API</li>
<li>add a configuration utility to allow users on the Pi to configure the board</li>
</ul>

<p>We're doing this using external power supplies to make the development cycles
faster. (Well, would <em>you</em> want to add &quot;wait for the batteries to discharge&quot;
to every edit/compile/test loop?!) I'm writing this post next to a large
humming monster:</p>

<p><img class="cow-img" src="/static/images/mopi/test-rigs/sofia-20140421-154603-500.jpg" alt="Test Rig" width="500"></p>

<p>The Pi is drawing 170 mA; MoPi is getting 11.9 volts from the PSU. The PSU
connects up to one of MoPi's supply inputs using a couple of re-purposed panel
pins:</p>

<p><img class="cow-img" src="/static/images/mopi/test-rigs/sofia-20140421-113148-500.jpg" alt="Test Rig" width="500"></p>

<p>Mission control (helicopter not strictly necessary):</p>

<p><img class="cow-img" src="/static/images/mopi/test-rigs/sofia-20140421-154651-500.jpg" alt="Test Rig" width="500"></p>

<!--% %image(images/mopi/test-rigs/sofia-20140421-113213-500.jpg, Test Rig, 500)-->

<!--% %image(images/mopi/test-rigs/sofia-20140421-154556-500.jpg, Test Rig, 500)-->

<!--% %image(images/mopi/test-rigs/sofia-20140421-113123-500.jpg, Test Rig, 500)-->

<!--% %image(images/mopi/test-rigs/sofia-20140421-113138-500.jpg, Test Rig, 500)-->


<p>We've also got a flash new PSU down at the workshop:</p>

<p><img class="cow-img" src="/static/images/mopi/test-rigs/workshop-20140409-153037-500.jpg" alt="Test Rig" width="500"></p>

<p><img class="cow-img" src="/static/images/mopi/test-rigs/workshop-20140409-153052-500.jpg" alt="Test Rig" width="500"></p>

<p>And here's Fred after I just showed him the bill:</p>

<p><img class="cow-img" src="/static/images/mopi/test-rigs/workshop-20140409-153131-500.jpg" alt="Test Rig" width="500"></p>

<p>While we're showing my snaps, here's one of my absolute favourite bits of kit
ever:</p>

<p><img class="cow-img" src="/static/images/mopi/test-rigs/workshop-20140409-153029-500.jpg" alt="Test Rig" width="500"></p>
<!--% %image(images/mopi/test-rigs/workshop-20140409-153021-500.jpg, Test Rig, 500)-->


<p>This multimeter has been running reliably for 30 years! Ok, at some point I
couldn't get the batteries any more, so I had to bodge up a container for a
different size, but apart from that it has been pretty much perfect. I plugged
it into our new PSU, dialed up 6.2 volts and hey presto! The meter and the PSU
agreed 100%. Can I marry my multimeter?</p>

<p>We've got a new shiney one too, but the romance just isn't there:</p>

<!--% %image(images/mopi/test-rigs/workshop-20140409-153039-500.jpg, Test Rig, 500)-->

<p><img class="cow-img" src="/static/images/mopi/test-rigs/workshop-20140409-153043-500.jpg" alt="Test Rig" width="500"></p>

<p>Anyhow, after this work is finished, we will:</p>

<ul>
<li>run a bunch of battery tests using the 2600 mAh AAs that we're going to ship
  to backers who chose rewards with batteries in</li>
<li>complete the user guide and developer documentation</li>
<li>scratch our heads and wonder what we've forgotten?</li>
</ul>

<p>Here are the battery rigs waiting to go:</p>

<!--% %image(images/mopi/test-rigs/workshop-20140409-152525-500.jpg, Battery Rig, 500)-->


<p><img class="cow-img" src="/static/images/mopi/test-rigs/workshop-20140409-152533-500.jpg" alt="Battery Rig" width="500"></p>

<p><img class="cow-img" src="/static/images/mopi/test-rigs/workshop-20140409-152538-500.jpg" alt="Battery Rig" width="500"></p>

<p>Do say: wow, you're really taking this seriously! Don't say: so, Professor
Cunningham, you popped out to buy a battery about a year ago and you haven't
actually finished yet?</p>


<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-5."></a><h1 class="cow-heading"><span class="cow-sec-number">5. </span>Linux is Lovely</h1>

<p>One of the great things about the Pi is that it runs a <a class="cow-url" href="http://fsf.org/">free
and open source</a> software stack. This makes development so much easier &mdash;
and here's an example of why...</p>

<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->
<a class="cow-section-anchor" name="section-5.1."></a><h2 class="cow-heading"><span class="cow-sec-number">5.1. </span>Enabling I2C and Debugging with I2C Tools</h2>

<p>Now that MoPi uses I2C as its communication mechanism, we have to enable this
in the SimBaMon package. Here's how we do it<span class="cow-footnote" name="footnote4"><sup><a href="#footnote4">4</a></sup></span>:</p>

<ul>
<li>if i2c-tools isn't already installed, install it:
  <ul>
  <li><tt>sudo apt-get install i2c-tools</tt></li>
  </ul></li>
<li>(you might as well do the same with <tt>python-smbus</tt> for testing purpose)</li>
<li>edit <tt>/etc/modules</tt> and add lines <tt>i2c-bcm2708</tt> and <tt>i2c-dev</tt></li>
<li>edit <tt>/etc/modprobe.d/raspi-blacklist</tt> (if it exists) and comment out the
  line <tt>blacklist i2c-bcm2708</tt> (by adding a <tt>#</tt> at the start of the line)</li>
</ul>

<p>The process of developing our interface involved hacking the <tt>i2c-tools</tt>
package to play with the multi-byte read facility in the <tt>i2cdump</tt> command.
On a closed-source operating system, of course, you would be stymied at this
point. On Linux it is super easy :-)</p>

<p>Here's how to pull down the source code, rebuild and test:</p>

<ul>
<li>edit <tt>/etc/apt/sources.lst</tt> and add this line:
  <ul>
  <li><tt>deb-src <a class="cow-url" href="http://mirrordirector.raspbian.org/raspbian/">http://mirrordirector.raspbian.org/raspbian/</a> wheezy main contrib
    non-free rpi</tt></li>
  </ul></li>
<li>then
  <ul>
  <li><tt>sudo apt-get update</tt></li>
  <li><tt>mkdir i2c-tools</tt></li>
  <li><tt>cd i2c-tools</tt></li>
  <li><tt>apt-get source i2c-tools</tt></li>
  </ul></li>
<li>then <tt>make</tt> will recompile (the tools are in the directory <tt>tools</tt>)</li>
</ul>

<p>Hey presto, I can hack away at the C code and get immediate feedback with
commands like <tt>sudo tools/i2cdump -y 1 0x0b i</tt> (where <tt>0x0b</tt> is MoPi's
designated I2C address &mdash; the smart battery address)<span class="cow-footnote" name="footnote5"><sup><a href="#footnote5">5</a></sup></span>.</p>

<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->

<!--% %2 Joining In-->


<!--% You can see some of the checkins for the -->

<!--% TODO-->



<!--%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%-->



<p><b><a class="cow-url" href="/pages/mopi.html">Read the main article</a>.</b></p>
<span class="cow-footnote-section">
<h1 class="cow-heading">Footnotes</h1>
<p><ol>
<li>
<a class="cow-footnote-anchor" name="footnote1"></a>
<span class="cow-footnote-text" name="footnote1">He ended up in an ambulance being rushed to
hospital, but then it must be tough being a macho Aussie :-<span class="cow-escape">)</span>.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote2"></a>
<span class="cow-footnote-text" name="footnote2">Quite why this little component has
gone out of stock is a mystery. Perhaps a containerful fell off a ship
somewhere? Or a huge client of the manufacturer ordered 10s of thousands? Or
perhaps Apple has identified us as an important competitor and is seeking to
slow down our meteoric rise? Answers on a postcard please...</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote3"></a>
<span class="cow-footnote-text" name="footnote3">Image from
<a class="cow-url" href="http://setsail.com/submerged-shipping-containers/">http://setsail.com/submerged-shipping-containers/</a>.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote4"></a>
<span class="cow-footnote-text" name="footnote4">The key steps are
described in various places, including
<a class="cow-url" href="https://learn.adafruit.com/adafruits-raspberry-pi-lesson-4-gpio-setup/configuring-i2c">on Adafruit</a>.</span>
</li>
<li>
<a class="cow-footnote-anchor" name="footnote5"></a>
<span class="cow-footnote-text" name="footnote5">For a revision 1
Pi &mdash; the very early boards &mdash; use <tt>0</tt> instead of <tt>1</tt>.</span>
</li>
</ol></p>
</span>


<br/> <br/>
</html>